<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Penalty Track</title>
  <link rel="stylesheet" href="styles.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <header>
    <h1>📦 Penalty Track</h1>
    <div class="cfg">
      <details>
        <summary>⚙️ Konfiguration</summary>
        <div>
          <label>API URL (Apps Script /exec)
            <input id="apiUrl" placeholder="https://script.google.com/macros/s/.../exec" />
          </label>
          <label>API Key (alle)
            <input id="apiKey" placeholder="API Key" />
          </label>
          <label>Admin Key (nur Admin)
            <input id="adminKey" placeholder="Admin Key" />
          </label>
          <div style="margin-top:16px;display:flex;gap:8px;">
            <button id="saveCfg">Speichern</button>
            <button id="clearCfg" class="secondary">Zurücksetzen</button>
          </div>
        </div>
      </details>
      <span class="roleTag" id="roleTag">Rolle: –</span>
    </div>
  </header>

  <!-- Startscreen -->
  <section id="screenRole" class="card welcome-screen">
    <h2>👋 Willkommen bei Penalty Track</h2>
    <p class="subtitle">Wähle deine Rolle aus:</p>
    <div class="role-buttons">
      <div class="role-card">
        <button id="btnPlayer" class="role-btn player-btn">
          <div class="role-icon">👤</div>
          <div class="role-title">Spieler</div>
          <div class="role-desc">Strafen anzeigen und einsehen</div>
        </button>
        <p class="role-hint">Einfach klicken - kein Passwort nötig</p>
      </div>
      <div class="role-card">
        <div class="admin-section">
          <input id="adminPwd" type="password" placeholder="Admin-Passwort eingeben" class="admin-input" />
          <button id="btnAdmin" class="role-btn admin-btn">
            <div class="role-icon">🛡️</div>
            <div class="role-title">Admin</div>
            <div class="role-desc">Strafen verwalten und erfassen</div>
          </button>
        </div>
      </div>
    </div>
  </section>

  <!-- Tabs -->
  <nav id="tabs" class="tabs hidden">
    <button data-tab="tab1" class="active">1) Dashboard</button>
    <button data-tab="tab2">2) Strafen (Spieler)</button>
    <button data-tab="tab3" id="tab3btn" class="adminOnly">3) Strafenerfassung</button>
    <button data-tab="tab4" id="tab4btn" class="adminOnly">4) Stammdaten</button>
  </nav>

  <!-- Tab 1: Dashboard -->
  <section id="tab1" class="tab card hidden">
    <h2>Dashboard</h2>
    <div class="row">
      <div class="card">
        <h3>Pott (Summe €)</h3>
        <div id="pott" class="kpi">0 €</div>
      </div>
      <div class="card">
        <h3>Top 3 Spieler (Summe €)</h3>
        <ol id="top3"></ol>
      </div>
    </div>
    <div class="card">
      <h3>Akkumulierte Strafen über Zeit</h3>
      <canvas id="chart"></canvas>
    </div>
  </section>

  <!-- Tab 2: Detail by Spieler -->
  <section id="tab2" class="tab card hidden">
    <h2>Strafen pro Spieler</h2>
    <label>Spieler wählen
      <select id="filterPlayer"></select>
    </label>
    <table class="table">
      <thead>
        <tr><th>Datum</th><th>Spieler</th><th>Vergehen</th><th>Betrag (€)</th></tr>
      </thead>
      <tbody id="detailBody"></tbody>
    </table>
  </section>

  <!-- Tab 3: Erfassung (Admin) -->
  <section id="tab3" class="tab card hidden">
    <h2>Strafenerfassung (Admin)</h2>
    <div class="row">
      <label>Spieler (Mehrfachauswahl)
        <select id="entryPlayers" multiple size="6"></select>
      </label>
      <label>Strafe (aus Stammdaten)
        <select id="entryFine"></select>
      </label>
    </div>
    <div class="row">
      <label>Zeitstempel
        <input id="entryTs" type="datetime-local" />
      </label>
    </div>
    <button id="saveEntry" class="primary">➕ Speichern</button>
    <div id="msgEntry" class="muted"></div>
  </section>

  <!-- Tab 4: Stammdaten (Admin) -->
  <section id="tab4" class="tab card hidden">
    <h2>Stammdaten (Admin)</h2>

    <div class="row">
      <div class="card flex1">
        <h3>Spieler</h3>
        <div class="row">
          <input id="playerName" placeholder="Neuer/zu ändernder Spielername" />
          <button id="addPlayer" class="primary">Speichern/Upsert</button>
        </div>
        <ul id="playersList"></ul>
      </div>

      <div class="card flex1">
        <h3>Strafen (Vergehen & Betrag €)</h3>
        <div class="row">
          <input id="fineName" placeholder="Vergehen" />
          <input id="fineAmount" placeholder="Betrag (€)" type="number" step="0.01" />
          <button id="addFine" class="primary">Speichern/Upsert</button>
        </div>
        <ul id="finesList"></ul>
      </div>
    </div>
  </section>

  <script src="app.js"></script>
</body>
</html>